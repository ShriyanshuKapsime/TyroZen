<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Budget Manager | TyroZen</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='budget.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<nav class="navbar">
    <a href="{{ url_for('todo') }}" class="nav-item">To-Do</a>
    <a href="{{ url_for('notes') }}" class="nav-item">Notes</a>
    <a href="{{ url_for('habits') }}" class="nav-item">Habits</a>
    <a href="{{ url_for('dashboard') }}" class="nav-item nav-dashboard">Dashboard</a>
    <a href="{{ url_for('attendance') }}" class="nav-item">Attendance</a>
    <a href="{{ url_for('budget') }}" class="nav-item active">Budget</a>
    <a href="{{ url_for('documents') }}" class="nav-item">Documents</a>
</nav>

<section class="page-wrap">
  <div class="container">

    <header class="page-header">
      <h1>Budget Manager</h1>
      <p class="muted">Track your budget, spending, and savings — all in one place.</p>
    </header>

    <div class="grid">

      <!-- LEFT SIDE -->
      <div class="col controls">

        <!-- Set Budget -->
        <div class="card money">
          <h3>Set Monthly Budget</h3>
          <form method="POST">
            <input type="hidden" name="form_type" value="set_budget">
            <label>Total Budget (₹)</label>
            <input name="total" type="number" step="0.01" required value="{{ total or 0 }}">
            <button class="btn primary">Save Budget</button>
          </form>
        </div>

        <!-- Add Expense -->
        <div class="card notes">
          <h3>Add Expense</h3>
          <form method="POST">
            <input type="hidden" name="form_type" value="add_expense">

            <label>Item</label>
            <input name="item" type="text" required>

            <label>Amount (₹)</label>
            <input name="amount" type="number" step="0.01" required>

            <label>Category</label>
            <select name="category" required>
              <option>Food & Drink</option>
              <option>Transport</option>
              <option>Groceries</option>
              <option>Subscriptions</option>
              <option>Study</option>
              <option>Other</option>
            </select>

            <button class="btn accent">Add Expense</button>
          </form>
        </div>

        <!-- Summary -->
        <div class="card docs">
          <h3>Summary</h3>

          {% set spent = (total - remaining) %}
          <dl class="summary">
            <dt>Total Budget</dt><dd>₹ {{ total|round(2) }}</dd>
            <dt>Total Spent</dt><dd>₹ {{ spent|round(2) }}</dd>
            <dt>Remaining</dt><dd>₹ {{ remaining|round(2) }}</dd>
          </dl>
        </div>

        <!-- AI Advisor Section -->
        <div class="card ai-block">
            <h3>AI Budget Advisor</h3>

            <form method="GET" action="/budget">
                <input type="hidden" name="ai" value="1">
                <button class="btn primary">Generate Advice</button>
            </form>

            {% if advice %}
            <div class="ai-box">
                <h4>Your AI Advice:</h4>
                <p>{{ advice }}</p>
            </div>
            {% endif %}
        </div>

      </div>

      <!-- RIGHT SIDE -->
      <div class="col charts">

        <!-- Pie Chart -->
        <div class="card todo">
          <h3>Spending by Category</h3>
          <canvas id="pieChart"></canvas>
        </div>

        <!-- Bar Chart -->
        <div class="card todo">
          <h3>Category Breakdown</h3>
          <canvas id="barChart"></canvas>
        </div>

        <!-- Recent Expenses -->
        <div class="card todo">
          <h3>Recent Expenses</h3>
          <table class="expenses-table">
            <thead>
              <tr><th>Item</th><th>Category</th><th>Amount</th></tr>
            </thead>

            <tbody>
              {% for e in expenses|reverse %}
                <tr>
                  <td>{{ e.item }}</td>
                  <td>{{ e.category }}</td>
                  <td>₹ {{ e.amount|round(2) }}</td>
                </tr>
              {% else %}
                <tr><td colspan="3" class="muted">No expenses yet</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>

    </div>
  </div>
</section>


<!-- CHART SCRIPT -->
<script>
  const labels = {{ category_totals.keys()|list|tojson }};
  const values = {{ category_totals.values()|list|tojson }};

  // PIE CHART
  new Chart(document.getElementById("pieChart"), {
    type: "pie",
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: ["#86b6f6", "#f7c873", "#9be7b3", "#f2a6a6", "#c6b0f4", "#d6d6d6"]
      }]
    }
  });

  // BAR CHART
  new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "Amount (₹)",
        data: values,
        backgroundColor: "#3A7AFE"
      }]
    }
  });
</script>

</body>
</html>

